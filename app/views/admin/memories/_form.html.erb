<style>
  .form-input-primary:focus { border-color: #C1DDD8 !important; box-shadow: 0 0 0 4px rgba(193,221,216,0.2) !important; outline: none; }
  .form-input-primary:hover { border-color: #C1DDD8; }
  .upload-zone:hover { border-color: #C1DDD8 !important; background-color: rgba(193,221,216,0.05) !important; }
  .album-label:hover { border-color: #C1DDD8 !important; }
  .album-label:has(input:checked) { border-color: #C1DDD8 !important; background-color: rgba(193,221,216,0.1) !important; }
</style>

<%= form_with model: [:admin, memory], local: true, class: "space-y-6" do |f| %>
  <!-- Error messages -->
  <% if memory.errors.any? %>
    <div class="p-4 rounded-xl border-2" style="background-color: #FEF2F2; border-color: #FECACA;">
      <div class="flex items-start gap-3">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 text-red-500 mt-0.5 flex-shrink-0">
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m9-.75a9 9 0 11-18 0 9 9 0 0118 0zm-9 3.75h.008v.008H12v-.008z" />
        </svg>
        <div>
          <p class="font-heading font-semibold text-red-700">Có <%= memory.errors.count %> lỗi xảy ra:</p>
          <ul class="list-disc list-inside text-sm text-red-600 mt-2 space-y-1">
            <% memory.errors.full_messages.each do |msg| %>
              <li><%= msg %></li>
            <% end %>
          </ul>
        </div>
      </div>
    </div>
  <% end %>

  <!-- Title -->
  <div>
    <label for="memory_title" class="flex items-center gap-1 text-sm font-semibold text-gray-700 mb-2 font-heading">
      Tiêu đề
      <span class="text-red-500">*</span>
    </label>
    <%= f.text_field :title,
      class: "form-input-primary w-full px-4 py-3 rounded-xl border-2 border-gray-200 transition-all duration-200 font-body placeholder-gray-400",
      placeholder: "VD: Nụ cười đầu tiên" %>
  </div>

  <!-- Caption -->
  <div>
    <label for="memory_caption" class="block text-sm font-semibold text-gray-700 mb-2 font-heading">Mô tả</label>
    <%= f.text_area :caption,
      rows: 3,
      class: "form-input-primary w-full px-4 py-3 rounded-xl border-2 border-gray-200 transition-all duration-200 font-body placeholder-gray-400 resize-none",
      placeholder: "Ghi lại những kỷ niệm đáng nhớ..." %>
  </div>

  <!-- Grid: Date, Age Group, Type -->
  <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
    <div>
      <label for="memory_taken_at" class="flex items-center gap-1 text-sm font-semibold text-gray-700 mb-2 font-heading">
        Ngày <span class="text-red-500">*</span>
      </label>
      <%= f.datetime_field :taken_at,
        class: "form-input-primary w-full px-4 py-3 rounded-xl border-2 border-gray-200 transition-all duration-200 font-body" %>
    </div>

    <div>
      <label for="memory_age_group" class="flex items-center gap-1 text-sm font-semibold text-gray-700 mb-2 font-heading">
        Giai đoạn <span class="text-red-500">*</span>
      </label>
      <%= f.select :age_group, Memory::AGE_GROUPS, {},
        class: "form-input-primary w-full px-4 py-3 rounded-xl border-2 border-gray-200 transition-all duration-200 font-body cursor-pointer" %>
    </div>

    <div>
      <label for="memory_memory_type" class="flex items-center gap-1 text-sm font-semibold text-gray-700 mb-2 font-heading">
        Loại <span class="text-red-500">*</span>
      </label>
      <%= f.select :memory_type, [["Ảnh", "photo"], ["Video", "video"]], {},
        class: "form-input-primary w-full px-4 py-3 rounded-xl border-2 border-gray-200 transition-all duration-200 font-body cursor-pointer" %>
    </div>
  </div>

  <!-- File Upload -->
  <div>
    <label class="block text-sm font-semibold text-gray-700 mb-2 font-heading">Ảnh/Video</label>

    <% if memory.media.attached? %>
      <div class="mb-4 p-4 rounded-xl bg-gray-50 border-2 border-gray-200 flex items-center gap-4">
        <% if memory.memory_type == 'video' %>
          <div class="w-20 h-20 rounded-lg bg-gray-200 flex items-center justify-center">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-8 h-8 text-gray-400">
              <path stroke-linecap="round" stroke-linejoin="round" d="M5.25 5.653c0-.856.917-1.398 1.667-.986l11.54 6.348a1.125 1.125 0 010 1.971l-11.54 6.347a1.125 1.125 0 01-1.667-.985V5.653z" />
            </svg>
          </div>
        <% else %>
          <%= image_tag memory.media.variant(resize_to_fill: [80, 80]), class: "w-20 h-20 rounded-lg object-cover" %>
        <% end %>
        <div class="flex-1 min-w-0">
          <p class="font-heading font-medium text-gray-800 truncate"><%= memory.media.filename %></p>
          <p class="text-sm text-gray-500 font-body"><%= number_to_human_size(memory.media.byte_size) %></p>
        </div>
        <div class="px-3 py-1 rounded-full text-xs font-body" style="background-color: #E0EEEB; color: #333;">
          Đã tải lên
        </div>
      </div>
    <% end %>

    <div class="relative">
      <%= f.file_field :media,
        accept: "image/*,video/*",
        class: "sr-only",
        id: "memory_media_input" %>

      <label for="memory_media_input"
        class="upload-zone flex flex-col items-center justify-center p-8 rounded-xl border-2 border-dashed border-gray-300 bg-gray-50 cursor-pointer transition-all duration-200">
        <div class="w-14 h-14 rounded-full flex items-center justify-center mb-3" style="background-color: rgba(193,221,216,0.3);">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-7 h-7" style="color: #A8CEC8;">
            <path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5m-13.5-9L12 3m0 0l4.5 4.5M12 3v13.5" />
          </svg>
        </div>
        <p class="font-heading font-semibold text-gray-700">Kéo thả hoặc nhấp để chọn file</p>
        <p class="text-sm text-gray-500 mt-1 font-body">PNG, JPG, MP4 • Tối đa 100MB</p>
      </label>
    </div>
  </div>

  <!-- Albums -->
  <% if Album.any? %>
    <div>
      <label class="block text-sm font-semibold text-gray-700 mb-3 font-heading">Albums</label>
      <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
        <% Album.all.each do |album| %>
          <label class="album-label flex items-center gap-3 p-3 rounded-xl border-2 border-gray-200 cursor-pointer transition-colors">
            <%= check_box_tag "memory[album_ids][]", album.id, memory.album_ids.include?(album.id),
              class: "w-5 h-5 rounded border-gray-300 cursor-pointer", style: "accent-color: #C1DDD8;" %>
            <span class="font-body text-sm text-gray-700"><%= album.name %></span>
          </label>
        <% end %>
      </div>
      <%= hidden_field_tag "memory[album_ids][]", "" %>
    </div>
  <% end %>

  <!-- Buttons -->
  <div class="flex items-center gap-4 pt-4">
    <%= f.submit memory.persisted? ? "Cập nhật" : "Tạo kỷ niệm",
      class: "px-6 py-3 rounded-xl font-heading font-semibold text-gray-800 cursor-pointer shadow-md hover:shadow-lg transition-all duration-200",
      style: "background: linear-gradient(135deg, #C1DDD8 0%, #A8CEC8 100%);" %>
    <%= link_to "Hủy", admin_memories_path,
      class: "px-6 py-3 rounded-xl font-heading font-semibold text-gray-600 hover:text-gray-800 hover:bg-gray-100 transition-colors" %>
  </div>
<% end %>
