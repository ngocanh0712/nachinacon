<%= form_with model: [:admin, memory], local: true, class: "space-y-6" do |f| %>
  <% if memory.errors.any? %>
    <div class="p-4 rounded-lg" style="background-color: #F8D8D8;">
      <p class="font-medium text-gray-800 mb-2">Có lỗi xảy ra:</p>
      <ul class="list-disc list-inside text-sm text-gray-600">
        <% memory.errors.full_messages.each do |msg| %>
          <li><%= msg %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div>
    <label for="memory_title" class="block text-sm font-medium text-gray-700 mb-1">Tiêu đề *</label>
    <%= f.text_field :title, class: "w-full px-4 py-3 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:border-transparent", style: "--tw-ring-color: #C1DDD8;", placeholder: "VD: Nụ cười đầu tiên" %>
  </div>

  <div>
    <label for="memory_caption" class="block text-sm font-medium text-gray-700 mb-1">Mô tả</label>
    <%= f.text_area :caption, rows: 3, class: "w-full px-4 py-3 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:border-transparent resize-none", style: "--tw-ring-color: #C1DDD8;", placeholder: "Ghi lại những kỷ niệm đáng nhớ..." %>
  </div>

  <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
    <div>
      <label for="memory_taken_at" class="block text-sm font-medium text-gray-700 mb-1">Ngày *</label>
      <%= f.datetime_field :taken_at, class: "w-full px-4 py-3 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:border-transparent", style: "--tw-ring-color: #C1DDD8;" %>
    </div>

    <div>
      <label for="memory_age_group" class="block text-sm font-medium text-gray-700 mb-1">Giai đoạn *</label>
      <%= f.select :age_group, Memory::AGE_GROUPS, {}, class: "w-full px-4 py-3 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:border-transparent", style: "--tw-ring-color: #C1DDD8;" %>
    </div>

    <div>
      <label for="memory_memory_type" class="block text-sm font-medium text-gray-700 mb-1">Loại *</label>
      <%= f.select :memory_type, [["Ảnh", "photo"], ["Video", "video"]], {}, class: "w-full px-4 py-3 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:border-transparent", style: "--tw-ring-color: #C1DDD8;" %>
    </div>
  </div>

  <div>
    <label for="memory_media" class="block text-sm font-medium text-gray-700 mb-1">Ảnh/Video</label>
    <% if memory.media.attached? %>
      <div class="mb-3">
        <%= image_tag memory.media.variant(resize_to_limit: [300, 300]), class: "rounded-lg" %>
      </div>
    <% end %>
    <%= f.file_field :media, accept: "image/*,video/*", class: "w-full px-4 py-3 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:border-transparent file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:font-medium file:cursor-pointer", style: "--tw-ring-color: #C1DDD8; file:background-color: #C1DDD8;" %>
  </div>

  <% if Album.any? %>
    <div>
      <label class="block text-sm font-medium text-gray-700 mb-2">Albums</label>
      <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
        <% Album.all.each do |album| %>
          <label class="flex items-center gap-2 p-3 border border-gray-200 rounded-lg cursor-pointer hover:border-[#C1DDD8] transition-colors">
            <%= check_box_tag "memory[album_ids][]", album.id, memory.album_ids.include?(album.id), class: "w-4 h-4 rounded border-gray-300 text-[#C1DDD8] focus:ring-[#C1DDD8]" %>
            <span class="text-sm text-gray-700"><%= album.name %></span>
          </label>
        <% end %>
      </div>
      <%= hidden_field_tag "memory[album_ids][]", "" %>
    </div>
  <% end %>

  <div class="flex items-center gap-4">
    <%= f.submit memory.persisted? ? "Cập nhật" : "Tạo kỷ niệm", class: "px-6 py-3 rounded-lg font-heading font-semibold cursor-pointer transition-colors", style: "background-color: #C1DDD8; color: #333;" %>
    <%= link_to "Hủy", admin_memories_path, class: "px-6 py-3 rounded-lg font-medium text-gray-600 hover:text-gray-800" %>
  </div>
<% end %>
