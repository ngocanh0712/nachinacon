<!DOCTYPE html>
<html lang="vi">
<head>
  <title>NaChiNaCon - Ká»· niá»‡m cá»§a bÃ©</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta charset="UTF-8">
  <meta name="description" content="Website lÆ°u giá»¯ ká»· niá»‡m Ä‘Ã¡ng yÃªu cá»§a bÃ© NaChiNaCon">
  <%= csrf_meta_tags %>
  <%= csp_meta_tag %>

  <!-- Open Graph Tags -->
  <% if content_for?(:og_tags) %>
    <%= yield :og_tags %>
  <% else %>
    <meta property="og:title" content="NaChiNaCon - Ká»· niá»‡m cá»§a bÃ©">
    <meta property="og:description" content="Website lÆ°u giá»¯ ká»· niá»‡m Ä‘Ã¡ng yÃªu cá»§a bÃ©">
    <meta property="og:type" content="website">
    <meta property="og:image" content="<%= image_url('family-photo.jpg') rescue '' %>">
    <meta property="og:locale" content="vi_VN">
    <meta property="og:site_name" content="NaChiNaCon">
  <% end %>

  <!-- PWA Meta Tags -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="NaChiNaCon">
  <meta name="theme-color" content="#C1DDD8">
  <meta name="view-transition" content="same-origin">
  <link rel="manifest" href="/manifest.json">
  <link rel="apple-touch-icon" href="/icon-192.png">

  <!-- Preconnect to Google Fonts for faster loading -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

  <!-- Load Google Fonts with font-display: swap to prevent FOIT -->
  <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;500;600;700&family=Poppins:wght@400;500;600;700&family=Quicksand:wght@400;500;600;700&display=swap" rel="stylesheet">

  <%= stylesheet_link_tag "tailwind", "data-turbo-track": "reload" %>
  <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
  <%= javascript_importmap_tags %>
</head>

<body class="min-h-screen font-body text-gray-800 bg-background">
  <!-- Navigation -->
  <nav data-controller="mobile-menu" class="fixed top-0 left-0 right-0 backdrop-blur-sm shadow-sm z-50" style="background-color: rgba(255,255,255,0.95);">
    <div class="max-w-6xl mx-auto px-4 md:px-6 lg:px-8">
      <div class="flex items-center justify-between h-16">
        <!-- Logo -->
        <%= link_to root_path, class: "flex items-center gap-3 group" do %>
          <div class="w-10 h-10 rounded-xl flex items-center justify-center shadow-sm group-hover:shadow transition-shadow" style="background: linear-gradient(135deg, #C1DDD8 0%, #A8CEC8 100%);">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 text-white">
              <path stroke-linecap="round" stroke-linejoin="round" d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12z" />
            </svg>
          </div>
          <span class="font-heading font-bold text-xl text-gray-800 group-hover:text-gray-900 transition-colors">NaChiNaCon</span>
        <% end %>

        <!-- Desktop Navigation -->
        <div class="hidden md:flex items-center gap-1">
          <%= link_to root_path, class: "relative px-4 py-2 font-heading font-semibold text-sm transition-colors #{current_page?(root_path) ? 'text-gray-900' : 'text-gray-600 hover:text-gray-900'}" do %>
            <span class="relative">
              Trang chá»§
              <% if current_page?(root_path) %>
                <span class="absolute -bottom-1 left-0 right-0 h-0.5 rounded-full" style="background-color: #C1DDD8;"></span>
              <% end %>
            </span>
          <% end %>

          <%= link_to timeline_path, class: "relative px-4 py-2 font-heading font-semibold text-sm transition-colors #{current_page?(timeline_path) ? 'text-gray-900' : 'text-gray-600 hover:text-gray-900'}" do %>
            <span class="relative">
              Timeline
              <% if current_page?(timeline_path) %>
                <span class="absolute -bottom-1 left-0 right-0 h-0.5 rounded-full" style="background-color: #C1DDD8;"></span>
              <% end %>
            </span>
          <% end %>

          <%= link_to milestones_path, class: "relative px-4 py-2 font-heading font-semibold text-sm transition-colors #{current_page?(milestones_path) ? 'text-gray-900' : 'text-gray-600 hover:text-gray-900'}" do %>
            <span class="relative">
              Milestones
              <% if current_page?(milestones_path) %>
                <span class="absolute -bottom-1 left-0 right-0 h-0.5 rounded-full" style="background-color: #F2C2C2;"></span>
              <% end %>
            </span>
          <% end %>

          <%= link_to albums_path, class: "relative px-4 py-2 font-heading font-semibold text-sm transition-colors #{current_page?(albums_path) ? 'text-gray-900' : 'text-gray-600 hover:text-gray-900'}" do %>
            <span class="relative">
              Albums
              <% if current_page?(albums_path) %>
                <span class="absolute -bottom-1 left-0 right-0 h-0.5 rounded-full" style="background-color: #C0DFD0;"></span>
              <% end %>
            </span>
          <% end %>

          <% games_active = current_page?(games_hub_path) || current_page?(spin_wheel_path) || current_page?(then_vs_now_path) || request.path.start_with?('/games') %>
          <%= link_to games_hub_path, class: "relative px-4 py-2 font-heading font-semibold text-sm transition-colors #{games_active ? 'text-gray-900' : 'text-gray-600 hover:text-gray-900'}" do %>
            <span class="relative">
              Games
              <% if games_active %>
                <span class="absolute -bottom-1 left-0 right-0 h-0.5 rounded-full" style="background-color: #E8B0B0;"></span>
              <% end %>
            </span>
          <% end %>

          <% if admin_logged_in? %>
            <%= link_to admin_root_path, class: "ml-2 px-4 py-2 rounded-lg font-heading font-semibold text-sm transition-all hover:shadow-md", style: "background-color: #E0EEEB; color: #333;" do %>
              <span class="flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.324.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 011.37.49l1.296 2.247a1.125 1.125 0 01-.26 1.431l-1.003.827c-.293.24-.438.613-.431.992a6.759 6.759 0 010 .255c-.007.378.138.75.43.99l1.005.828c.424.35.534.954.26 1.43l-1.298 2.247a1.125 1.125 0 01-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.57 6.57 0 01-.22.128c-.331.183-.581.495-.644.869l-.213 1.28c-.09.543-.56.941-1.11.941h-2.594c-.55 0-1.02-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 01-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 01-1.369-.49l-1.297-2.247a1.125 1.125 0 01.26-1.431l1.004-.827c.292-.24.437-.613.43-.992a6.932 6.932 0 010-.255c.007-.378-.138-.75-.43-.99l-1.004-.828a1.125 1.125 0 01-.26-1.43l1.297-2.247a1.125 1.125 0 011.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.087.22-.128.332-.183.582-.495.644-.869l.214-1.281z" />
                  <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                </svg>
                Admin
              </span>
            <% end %>
          <% end %>
        </div>

        <!-- Mobile menu button -->
        <button data-action="click->mobile-menu#toggle" class="md:hidden p-2 rounded-lg hover:bg-gray-100 transition-colors focus:outline-none" style="--ring-color: #C1DDD8;">
          <svg data-mobile-menu-target="iconOpen" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6 text-gray-700">
            <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
          </svg>
          <svg data-mobile-menu-target="iconClose" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6 text-gray-700 hidden">
            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>
      </div>
    </div>

    <!-- Mobile menu -->
    <div data-mobile-menu-target="menu" class="md:hidden overflow-hidden transition-all duration-300" style="max-height: 0; background-color: #FAFAFA;">
      <div class="px-4 py-4 space-y-1 border-t border-gray-100">
        <%= link_to root_path, class: "flex items-center gap-3 px-4 py-3 rounded-xl font-heading font-semibold transition-colors", style: current_page?(root_path) ? "background-color: #E0EEEB; color: #111827;" : "color: #4B5563;" do %>
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 12l8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25" />
          </svg>
          Trang chá»§
        <% end %>

        <%= link_to timeline_path, class: "flex items-center gap-3 px-4 py-3 rounded-xl font-heading font-semibold transition-colors", style: current_page?(timeline_path) ? "background-color: #E0EEEB; color: #111827;" : "color: #4B5563;" do %>
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
          Timeline
        <% end %>

        <%= link_to milestones_path, class: "flex items-center gap-3 px-4 py-3 rounded-xl font-heading font-semibold transition-colors", style: current_page?(milestones_path) ? "background-color: #F8D8D8; color: #111827;" : "color: #4B5563;" do %>
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M11.48 3.499a.562.562 0 011.04 0l2.125 5.111a.563.563 0 00.475.345l5.518.442c.499.04.701.663.321.988l-4.204 3.602a.563.563 0 00-.182.557l1.285 5.385a.562.562 0 01-.84.61l-4.725-2.885a.563.563 0 00-.586 0L6.982 20.54a.562.562 0 01-.84-.61l1.285-5.386a.562.562 0 00-.182-.557l-4.204-3.602a.563.563 0 01.321-.988l5.518-.442a.563.563 0 00.475-.345L11.48 3.5z" />
          </svg>
          Milestones
        <% end %>

        <%= link_to albums_path, class: "flex items-center gap-3 px-4 py-3 rounded-xl font-heading font-semibold transition-colors", style: current_page?(albums_path) ? "background-color: rgba(192, 223, 208, 0.3); color: #111827;" : "color: #4B5563;" do %>
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 15.75l5.159-5.159a2.25 2.25 0 013.182 0l5.159 5.159m-1.5-1.5l1.409-1.409a2.25 2.25 0 013.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 001.5-1.5V6a1.5 1.5 0 00-1.5-1.5H3.75A1.5 1.5 0 002.25 6v12a1.5 1.5 0 001.5 1.5zm10.5-11.25h.008v.008h-.008V8.25zm.375 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z" />
          </svg>
          Albums
        <% end %>

        <% games_active_mobile = current_page?(games_hub_path) || current_page?(spin_wheel_path) || current_page?(then_vs_now_path) || request.path.start_with?('/games') %>
        <%= link_to games_hub_path, class: "flex items-center gap-3 px-4 py-3 rounded-xl font-heading font-semibold transition-colors", style: games_active_mobile ? "background-color: rgba(232, 176, 176, 0.2); color: #111827;" : "color: #4B5563;" do %>
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M14.25 6.087c0-.355.186-.676.401-.959.221-.29.349-.634.349-1.003 0-1.036-1.007-1.875-2.25-1.875s-2.25.84-2.25 1.875c0 .369.128.713.349 1.003.215.283.401.604.401.959v0a.64.64 0 01-.657.643 48.39 48.39 0 01-4.163-.3c.186 1.613.293 3.25.315 4.907a.656.656 0 01-.658.663v0c-.355 0-.676-.186-.959-.401a1.647 1.647 0 00-1.003-.349c-1.036 0-1.875 1.007-1.875 2.25s.84 2.25 1.875 2.25c.369 0 .713-.128 1.003-.349.283-.215.604-.401.959-.401v0c.31 0 .555.26.532.57a48.039 48.039 0 01-.642 5.056c1.518.19 3.058.309 4.616.354a.64.64 0 00.657-.643v0c0-.355-.186-.676-.401-.959a1.647 1.647 0 01-.349-1.003c0-1.035 1.008-1.875 2.25-1.875 1.243 0 2.25.84 2.25 1.875 0 .369-.128.713-.349 1.003-.215.283-.4.604-.4.959v0c0 .333.277.599.61.58a48.1 48.1 0 005.427-.63 48.05 48.05 0 00.582-4.717.532.532 0 00-.533-.57v0c-.355 0-.676.186-.959.401-.29.221-.634.349-1.003.349-1.035 0-1.875-1.007-1.875-2.25s.84-2.25 1.875-2.25c.37 0 .713.128 1.003.349.283.215.604.401.959.401v0a.656.656 0 00.658-.663 48.422 48.422 0 00-.37-5.36c-1.886.342-3.81.574-5.766.689a.578.578 0 01-.61-.58v0z" />
          </svg>
          Games
        <% end %>

        <% if admin_logged_in? %>
          <%= link_to admin_root_path, class: "flex items-center gap-3 px-4 py-3 rounded-xl font-heading font-semibold transition-colors", style: "color: #4B5563;" do %>
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.324.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 011.37.49l1.296 2.247a1.125 1.125 0 01-.26 1.431l-1.003.827c-.293.24-.438.613-.431.992a6.759 6.759 0 010 .255c-.007.378.138.75.43.99l1.005.828c.424.35.534.954.26 1.43l-1.298 2.247a1.125 1.125 0 01-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.57 6.57 0 01-.22.128c-.331.183-.581.495-.644.869l-.213 1.28c-.09.543-.56.941-1.11.941h-2.594c-.55 0-1.02-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 01-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 01-1.369-.49l-1.297-2.247a1.125 1.125 0 01.26-1.431l1.004-.827c.292-.24.437-.613.43-.992a6.932 6.932 0 010-.255c.007-.378-.138-.75-.43-.99l-1.004-.828a1.125 1.125 0 01-.26-1.43l1.297-2.247a1.125 1.125 0 011.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.087.22-.128.332-.183.582-.495.644-.869l.214-1.281z" />
              <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
            </svg>
            Admin Panel
          <% end %>
        <% end %>

        <!-- PWA Install Button (Mobile Only) -->
        <button id="installButtonMobile" class="hidden flex items-center gap-3 px-4 py-3 rounded-xl font-heading font-semibold transition-colors" style="background: rgba(168, 206, 200, 0.2); color: #5A9A8E;">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3" />
          </svg>
          CÃ i Ä‘áº·t App
        </button>
      </div>
    </div>
  </nav>

  <!-- Flash messages -->
  <% if flash[:notice] %>
    <div data-controller="flash-message" class="fixed top-20 right-4 z-50 bg-white px-5 py-3 rounded-xl shadow-lg border" style="border-color: #BBF7D0;">
      <div class="flex items-center gap-3">
        <div class="w-7 h-7 rounded-full flex items-center justify-center flex-shrink-0" style="background: #C0DFD0;">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-4 h-4 text-white">
            <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
        </div>
        <span class="font-heading font-medium text-gray-700 text-sm"><%= flash[:notice] %></span>
      </div>
    </div>
  <% end %>
  <% if flash[:alert] %>
    <div data-controller="flash-message" class="fixed top-20 right-4 z-50 bg-white px-5 py-3 rounded-xl shadow-lg border" style="border-color: #FECACA;">
      <div class="flex items-center gap-3">
        <div class="w-7 h-7 rounded-full flex items-center justify-center flex-shrink-0" style="background: #F2C2C2;">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-4 h-4 text-white">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m9-.75a9 9 0 11-18 0 9 9 0 0118 0zm-9 3.75h.008v.008H12v-.008z" />
          </svg>
        </div>
        <span class="font-heading font-medium text-gray-700 text-sm"><%= flash[:alert] %></span>
      </div>
    </div>
  <% end %>

  <!-- Main content -->
  <main class="pt-24">
    <%= yield %>
  </main>

  <!-- Footer -->
  <footer class="py-12 px-4 md:px-6 lg:px-8" style="background-color: #FAFAFA; border-top: 1px solid #E5E7EB;">
    <div class="max-w-6xl mx-auto text-center">
      <div class="flex items-center justify-center gap-3 mb-4">
        <div class="w-10 h-10 rounded-xl flex items-center justify-center shadow-sm" style="background: linear-gradient(135deg, #C1DDD8 0%, #A8CEC8 100%);">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 text-white">
            <path stroke-linecap="round" stroke-linejoin="round" d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12z" />
          </svg>
        </div>
        <span class="font-heading font-bold text-lg text-gray-800">NaChiNaCon</span>
      </div>
      <p class="font-accent text-xl mb-3" style="color: #666;">"Lá»›n lÃªn cÃ¹ng tÃ¬nh yÃªu, tá»«ng ká»· niá»‡m má»™t"</p>
      <p class="font-body text-sm text-gray-400">Made with love for our little prince</p>
    </div>
  </footer>

  <!-- PWA Service Worker Registration -->
  <script data-turbo-eval="false">
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/service-worker.js')
          .then((registration) => {
            console.log('Service Worker registered successfully:', registration.scope);
          })
          .catch((error) => {
            console.log('Service Worker registration failed:', error);
          });
      });
    }

    // PWA Install Button Handler (Mobile Menu)
    let deferredPrompt;
    const installButtonMobile = document.getElementById('installButtonMobile');

    window.addEventListener('beforeinstallprompt', (e) => {
      // Prevent default browser install prompt
      e.preventDefault();
      deferredPrompt = e;

      // Show custom install button in mobile menu
      if (installButtonMobile) {
        installButtonMobile.classList.remove('hidden');
        console.log('âœ… PWA install prompt available!');
      }
    });

    if (installButtonMobile) {
      installButtonMobile.addEventListener('click', async () => {
        if (!deferredPrompt) {
          console.log('âŒ No install prompt available');
          return;
        }

        // Show install prompt
        deferredPrompt.prompt();

        // Wait for user choice
        const { outcome } = await deferredPrompt.userChoice;
        console.log(`User choice: ${outcome}`);

        if (outcome === 'accepted') {
          console.log('âœ… User accepted the install');
        } else {
          console.log('âŒ User dismissed the install');
        }

        // Clear prompt
        deferredPrompt = null;
        installButtonMobile.classList.add('hidden');
      });
    }

    // Hide button after successful install
    window.addEventListener('appinstalled', () => {
      if (installButtonMobile) {
        installButtonMobile.classList.add('hidden');
        console.log('âœ… PWA installed successfully');

        // Optional: Show success message
        setTimeout(() => {
          alert('ðŸŽ‰ App Ä‘Ã£ Ä‘Æ°á»£c cÃ i Ä‘áº·t! Báº¡n cÃ³ thá»ƒ má»Ÿ app tá»« mÃ n hÃ¬nh chÃ­nh.');
        }, 1000);
      }
    });
  </script>

</body>
</html>
