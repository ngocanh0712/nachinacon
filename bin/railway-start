#!/bin/bash
set -ex

echo "==== RAILWAY START SCRIPT ===="
echo "All env vars related to PORT:"
env | grep -i port || echo "No PORT vars found"
echo "DATABASE_URL present: ${DATABASE_URL:+yes}"

# Use PORT from Railway, or default to 3000
RAILS_PORT=${PORT:-3000}
echo "Starting server on port: $RAILS_PORT"

echo "Running db:prepare..."
./bin/rails db:prepare

echo "Running seeds to ensure admin user is set up..."
./bin/rails db:seed

echo "Setup complete! Starting Rails server..."
exec ./bin/rails server -b 0.0.0.0 -p "${RAILS_PORT}"
